---
title: zero install을 사용하지 않는다면 yarn berry OR pnpm?
sidebar_position: 1
---

## Intro

이전 회사에서 근무할때 국제화 addon 기능을 활용하여 UI 컴포넌트를 테스트하기 위해 `Storybook` 도입을 담당했던 경험이 있습니다. Storybook v8은 yarn berry 버전 이상의 환경이 요구되었고 이를 대처하기 위한 마이그레이션 과정 중 `유령 종속성`과 `pnp`, `zero-install` 그리고 또 다른 패키지 매니저 `pnpm`을 알게되었습니다.  
<br/>
결과적으로 yarn berry v4로 `zero-install`을 적용했지만, 당시 `unplugged` 용량이 적지 않아 가장 기대하고 있었던 `DX적인 부분`에서 드라마틱한 효과는 볼 수 없었습니다. 빌드 시간은 조금 줄어들었지만, `브랜치를 옮겨다닐때마다 종속성을 깔고 지우는 루틴`은 바뀌지 않았기 때문입니다.

### 안정적이지 않은 상태의 기능이라면 당장 사용해야하는 이유가 있을까?

yarn에서도 [v4 릴리즈 노트에서 zero-install을 더이상 디폴트 설정으로 활성화하지 않겠다](https://yarnpkg.com/blog/release/4.0)는 결정을 했습니다. 케이스마다 효과가 다른 변동성을 가진 zero-install을 버린다면 확실하게 남는 기능은 `pnp`입니다.

문득 yarn의 간판 기능인 `zero-install을 버리고 pnp만 차용하더라도 다른 패키지 매니저에 비하면 더 나은 선택일까?` 라는 의문이 들었습니다. 유령 종속성 문제를 해결하는 기능이라면 `pnpm`으로도 동일한 효과를 볼 수 있기 때문입니다.

### yarn berry (with pnp) OR pnpm?

마이그레이션 작업을 했던 당시를 회고하며, `pnpm`과 비교한다면 `pnp 기능만 차용한 yarn berry의 성능적 이점`에는 무엇이 있을지 직접 확인해보고 그 과정을 작성해보겠습니다.
<br/>

---

## 개발 환경 조건

최대한 동일하고 기본적인 환경에서 비교를 시작하기 위해, 몇가지 조건을 설정하였습니다.
- [공통] build 결과물을 `'standalone'으로 경량화한 Next.js 기본 제공 템플릿`을 시작점으로 사용
- [yarn berry] zero-install을 사용하지 않고, `nodeLinker를 pnp로 설정`합니다.

    ||yarn berry|pnpm|
    |:------:|:------:|:------:|
    |Node|v20.11.1|v20.11.1|
    |Next.js|v14.2.5 (standalone build)|v14.2.5 (standalone build)|
    |Version|v4.3.1|v.9.5.0|

<br/>

## 비교 조건
최초 빌드를 기준으로 하기위해 workflow 캐시 작업은 제외하였습니다.   
`pnpm`의 경우 `pnpm store prune` 명령어로 pnpm의 cache를 삭제 후 측정하였습니다.   
docker의 이미지 build 시간은 `--no-cache 플래그`를 사용하여 캐시 없이 최초 측정을 작성하였습니다.

1) [🏠로컬] Dependency install 시간
2) [🏠로컬] Dependency 크기
3) [🏠로컬] .next 빌드 결과물 크기
4) [🐳Docker] 로컬 이미지 크기
5) [🐳Docker] 로컬 이미지 build 시간
6) [⚡️Github Actions] CI total workflow 시간
7) [⚡️Github Actions] Build Job, Build & Docker Push Step 시간

<br/>
## 과정

<br/>
## 결과

<br/>
---
## 느낀점
